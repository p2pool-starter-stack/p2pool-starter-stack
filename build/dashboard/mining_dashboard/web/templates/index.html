<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="30">
    <title>Mining Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {{ --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --accent: #58a6ff; --ok: #238636; --bad: #da3633; --warn: #d29922; --purple: #a371f7; }}
        body {{ font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }}
        
        .container {{ max-width: 1400px; margin: auto; }}
        .header {{ display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 20px; }}
        
        /* Grid Layout */
        .grid {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 20px; margin-bottom: 20px; }}
        
        /* Cards */
        .card {{ background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 15px; position: relative; }}
        h3 {{ margin: 0 0 15px 0; font-size: 14px; text-transform: uppercase; color: #8b949e; letter-spacing: 0.5px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }}
        
        /* Stat Grids */
        .stat-grid {{ display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }}
        .stat-card {{ background: #0d1117; padding: 8px 12px; border-radius: 4px; border: 1px solid var(--border); }}
        .stat-card h5 {{ margin: 0; font-size: 10px; color: #8b949e; text-transform: uppercase; }}
        .stat-card p {{ margin: 5px 0 0 0; font-weight: bold; font-size: 15px; }}
        
        /* Tables */
        table {{ width: 100%; border-collapse: collapse; }}
        th {{ text-align: left; font-size: 11px; color: #8b949e; padding: 8px; border-bottom: 1px solid var(--border); text-transform: uppercase; }}
        td {{ padding: 8px; border-bottom: 1px solid #21262d; font-size: 13px; }}
        tr:last-child td {{ border-bottom: none; }}
        
        /* Visuals */
        .dot {{ height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }}
        .online {{ background: var(--ok); box-shadow: 0 0 5px var(--ok); }} 
        .offline {{ background: var(--bad); }}
        .status-ok {{ color: var(--ok); }} 
        .status-bad {{ color: var(--bad); }} 
        .status-warn {{ color: var(--warn); }}
        .bold {{ font-weight: bold; color: var(--accent); }}
        
        .progress-bg {{ background: var(--border); border-radius: 4px; height: 6px; width: 100%; margin-top: 5px; overflow: hidden; }}
        .progress-fill {{ background: var(--accent); height: 100%; border-radius: 4px; }}
        .progress-fill.warning {{ background: var(--warn); }} 
        .progress-fill.critical {{ background: var(--bad); }}
        
        .pool-badge {{ background: {mode_color}; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 12px; vertical-align: middle; margin-left: 10px; font-weight: bold; }}
        .wallet-text {{ font-size: 10px; color: #666; margin-top: 10px; word-break: break-all; font-family: monospace; }}
        
        .chart-container {{ height: 180px; width: 100%; }}
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div>
            <div style="display:flex; align-items:center;">
                <h2 style="margin:0">{host_ip}</h2>
                <span class="pool-badge">{mode_name}</span>
                <span style="font-size: 12px; color: #8b949e; margin-left: 10px; border: 1px solid var(--border); padding: 2px 6px; border-radius: 4px;">P2Pool {p2p_type}</span>
            </div>
            
            <div style="margin-top: 8px; font-size: 13px;">
                <div style="margin-bottom: 4px;">
                    <span style="color: #8b949e;">CPU: {cpu_percent} Load: {cpu_load}</span>
                </div>
                <div style="margin-bottom: 4px;">
                    <span style="color: #8b949e; margin-right: 15px;">RAM: {mem_used} / {mem_total} GB ({mem_p})</span>
                    <span class="{hp_class}">Huge Pages: {hp_status} ({hp_val})</span>
                </div>
                <div>
                    <span style="color: #8b949e;">Disk: {disk_used:.1f} / {disk_total:.1f} GB ({disk_p})</span>
                    <div style="width: 200px; display: inline-block; vertical-align: middle; margin-left: 5px;">
                        <div class="progress-bg">
                            <div class="progress-fill {disk_fill_class}" style="width: {disk_width}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="text-align: right">
            <div style="font-size: 24px; font-weight: bold; color: var(--accent);">{total_hr}</div>
            <small style="color:#8b949e">Last Update: {last_update}</small>
            <div style="font-size: 11px; margin-top: 5px; color: #8b949e;">
                P2Pool: {p2p_1h} (1h) / {p2p_24h} (24h)
            </div>
            <div style="font-size: 11px; margin-top: 2px; color: {mode_color}">
                XvB: {xvb_1h} (1h) / {xvb_24h} (24h)
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            {chart_controls}
            <div style="position: relative; height: 350px; width: 100%;">
                <canvas id="hChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h3>My P2Pool Node Stats</h3>
            <div class="stat-grid">
                <div class="stat-card"><h5>Mining Mode</h5><p style="color:{mode_color}">{mode_name}</p></div>
                <div class="stat-card"><h5>Total Hashrate</h5><p>{total_hr}</p></div>
                <div class="stat-card"><h5>P2Pool 1h Avg</h5><p>{p2p_1h}</p></div>
                <div class="stat-card"><h5>P2Pool 24h Avg</h5><p>{p2p_24h}</p></div>
                
                <div class="stat-card" style="grid-column: span 2;">
                    <h5>Stratum (15m / 1h / 24h)</h5>
                    <p style="font-size: 12px;">{strat_h15} / {strat_h1h} / {strat_h24h}</p>
                </div>
                <div class="stat-card"><h5>Shares (OK/Err)</h5><p>{strat_shares}</p></div>
                <div class="stat-card"><h5>Effort</h5><p>{strat_effort}</p></div>
                <div class="stat-card"><h5>Connections</h5><p>{strat_conns}</p></div>
                <div class="stat-card"><h5>Reward Share</h5><p>{strat_reward_pct}</p></div>
                <div class="stat-card"><h5>Total Shares</h5><p>{strat_total_shares}</p></div>
                <div class="stat-card"><h5>Last Share</h5><p>{strat_last_share}</p></div>
                <div class="stat-card" style="grid-column: span 2;"><h5>Total Hashes</h5><p>{strat_total_hashes}</p></div>
            </div>
            <div class="wallet-text">Wallet: {strat_wallet}</div>
        </div>

        <div class="card">
            <h3>Global P2Pool Stats</h3>
            <div class="stat-grid">
                <div class="stat-card"><h5>Pool Hashrate</h5><p>{pool_hr}</p></div>
                <div class="stat-card"><h5>Miners</h5><p>{pool_miners}</p></div>
                <div class="stat-card"><h5>Block Height</h5><p>{pool_height}</p></div>
                <div class="stat-card"><h5>Difficulty</h5><p>{pool_diff}</p></div>
                <div class="stat-card"><h5>Blocks Found</h5><p>{pool_blocks}</p></div>
                <div class="stat-card"><h5>PPLNS Window</h5><p>{pplns_win}</p></div>
                <div class="stat-card"><h5>PPLNS Weight</h5><p>{pplns_wgt}</p></div>
                <div class="stat-card"><h5>Share In Window</h5><p>{pool_shares_window}</p></div>
                <div class="stat-card"><h5>Last Block</h5><p style="font-size: 12px;">{pool_last_blk}</p></div>
                <div class="stat-card"><h5>Peers</h5><p>{p2p_peers}</p></div>
                <div class="stat-card"><h5>Uptime</h5><p style="font-size: 11px;">{p2p_uptime}</p></div>
                <div class="stat-card"><h5>Total Hashes</h5><p>{pool_total_hashes}</p></div>
            </div>
        </div>

        <div class="card">
            <h3>XvB Donation Stats</h3>
            <div class="stat-grid">
                <div class="stat-card"><h5>Current Tier</h5><p>{tier_name}</p></div>
                <div class="stat-card"><h5>Target Tier</h5><p>{target_tier_name}</p></div>
                <div class="stat-card"><h5>1h Avg (Pool)</h5><p>{xvb_1h}</p></div>
                <div class="stat-card"><h5>24h Avg (Pool)</h5><p>{xvb_24h}</p></div>
                <div class="stat-card"><h5>Fail Count</h5><p>{xvb_fail_count}</p></div>
            </div>
            <div style="font-size:10px; color:#666; margin-top:10px;">Stats fetched from xmrvsbeast.com (Updated: {xvb_updated})</div>
        </div>

        <div class="card">
            <h3>XMR Network</h3>
            <div class="stat-grid">
                <div class="stat-card"><h5>Block Height</h5><p>{net_height}</p></div>
                <div class="stat-card"><h5>Reward</h5><p>{net_reward}</p></div>
                <div class="stat-card" style="grid-column: span 2;"><h5>Difficulty</h5><p>{net_diff}</p></div>
                <div class="stat-card" style="grid-column: span 2;">
                    <h5>Current Block Hash</h5>
                    <p style="font-size:10px; font-family:monospace;">{net_hash}</p>
                </div>
                <div class="stat-card" style="grid-column: span 2;"><h5>Network Time</h5><p>{net_ts}</p></div>
            </div>
        </div>
        
        <div class="card">
            <h3>Tari Merge Mining</h3>
            <div class="stat-grid">
                <div class="stat-card"><h5>Status</h5><p class="{tari_status_class}">{tari_status}</p></div>
                <div class="stat-card"><h5>Reward</h5><p>{tari_reward}</p></div>
                <div class="stat-card"><h5>Height</h5><p>{tari_height}</p></div>
                <div class="stat-card"><h5>Difficulty</h5><p>{tari_diff}</p></div>
            </div>
            <div class="wallet-text">Wallet: {tari_wallet}</div>
        </div>
    </div>

    <div class="card">
        <h3>Workers Alive</h3>
        <table>
            <thead>
                <tr>
                    <th>Worker</th>
                    <th>IP</th>
                    <th>Uptime</th>
                    <th>10s</th>
                    <th>60s</th>
                    <th>15m</th>
                    <th style="width:30px"></th>
                </tr>
            </thead>
            <tbody>
                {worker_rows}
            </tbody>
        </table>
    </div>
</div>
<script>
    new Chart(document.getElementById('hChart'), {{
        type: 'line',
        data: {{
            labels: [{chart_labels}],
            datasets: [{{ 
                label: 'H/s', 
                data: [{chart_data}], 
                borderColor: '#58a6ff', 
                tension: 0.3, 
                fill: true, 
                backgroundColor: 'rgba(88,166,255,0.1)',
                pointRadius: 0,
                pointHitRadius: 10
            }}]
        }},
        options: {{ 
            responsive: true, 
            maintainAspectRatio: false, 
            plugins: {{ legend: {{ display: false }} }}, 
            scales: {{ 
                y: {{ grid: {{ color: '#30363d' }}, ticks: {{ color: '#8b949e' }} }}, 
                x: {{ display: false }} 
            }} 
        }}
    }});
</script>
</body>
</html>